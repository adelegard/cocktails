#search_results
  -if @recipes.length > 0 then
    %table.table.table-striped
      %thead
        %tr
          %th.tal
            = sortable "title", "Title"
            .asc.dn
            .desc.dn
          %th.tal
            = sortable "rating_avg", "Rating"
            .asc.dn
            .desc.dn
          %th.tal
            = sortable "rating_count", "Popularity"
            .asc.dn
            .desc.dn
          - if user_signed_in?
            %th.tal
              = sortable "Favorite"
              .asc.dn
              .desc.dn
          - else
            %th.tal
              %a{:href => "#"} Favorite
      %tbody
        -@recipes.each do |recipe|
          -if @recipe_users != nil
            - @recipe_user = @recipe_users.detect {|ru| ru.recipe_id == recipe.id }
          - @the_recipe = recipe
          %tr
            %td.tal= link_to(recipe.title, recipe)
            %td.tal
              =render :partial => 'recipes/rating_links_small'
            %td.tal
              - puts "recipe count: " + recipe.rating_count.to_s
              - puts "total: " + @total_ratings.to_s
              - percent = ((recipe.rating_count.to_f/@total_ratings)).to_f.round(3)*100*3
              - puts "percent: " + percent.to_s
              - percent = percent.nan? ? 4 : percent
              - percent = percent > 100 ? 100 : percent
              - percent = percent < 4 ? 4 : percent
              .popularity{:style => "width:#{percent}%"}
            //%td.tal= recipe.rating_count
            %td
              -if @recipe_user != nil && @recipe_user.starred
                -favoriteClass = "favorite"
              -else
                -favoriteClass = "no-favorite"
              %a{:href => "/favorite?recipe_id=#{recipe.id}", :class => "#{favoriteClass}"}
  = will_paginate @recipes
